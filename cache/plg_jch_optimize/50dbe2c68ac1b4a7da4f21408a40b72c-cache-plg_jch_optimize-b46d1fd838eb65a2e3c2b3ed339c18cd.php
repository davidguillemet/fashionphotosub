<?php die("Access Denied"); ?>#x#a:2:{s:6:"output";s:0:"";s:6:"result";s:38770:"(function(){dojo.require('dojo.uacss');dojo.declare("AJAXSearchBase",null,{constructor:function(args){dojo.mixin(this,args);this.list=new Array();this.selected=0;this.pluginCounter=new Array();this.timeStamp=0;this.categoryChooserVisible=0;this.resultsVisible=0;this.fadeInResult=1;if(this.voicesearch==1)dojo.attr(this.textBox,"x-webkit-speech","");if(dojo.isIE<=7){var w=dojo.position(this.textBox.parentNode).w-dojo.style(this.textBox,'paddingLeft')-dojo.style(this.textBox,'paddingRight');dojo.style(this.textBox,'width',(w-1)+'px');}
this.searchBoxContainer=dojo.query(".offlajn-ajax-search-container",this.node)[0];if(this.catChooser){this.categoryChooser=dojo.query(".category-chooser",this.searchForm)[0];dojo.place(this.searchCategories,dojo.body());this.searchCategoriesList=dojo.query(".search-categories-inner div",this.searchCategories);}
if(this.catChooser){dojo.connect(this.categoryChooser,'onclick',this,'showCategoryChooser');dojo.connect(this.categoryChooser,"onclick",this,"stopCategoryChooserEventBubble");}
dojo.attr(this.textBox,"value",this.searchBoxCaption);dojo.addClass(this.textBox,"search-caption-on");this.suggestBox.value=""
if(this.searchResult){dojo.connect(this.textBox,'onkeyup',this,'type');dojo.connect(this.textBox,'oncompositionupdate',this,'type');}
dojo.connect(this.textBox,'onfocus',this,'textBoxFocus');dojo.connect(this.textBox,'onblur',this,'textBoxBlur');dojo.connect(this.textBox,'onwebkitspeechchange',this,'soundEnd');if(this.keywordSuggestion=="1"){dojo.connect(this.textBox,'onkeyup',this,'suggest');}
dojo.connect(this.suggestBox,'onfocus',this,'suggestBoxFocus');dojo.connect(this.suggestBox,"onclick",this,"stopEventBubble");dojo.connect(this.closeButton,'onclick',this,'closeResults');dojo.connect(this.searchButton,'onclick',this,'loadResult');dojo.connect(this.textBox,"onclick",this,"stopInputEventBubble");if(this.catChooser)
dojo.forEach(this.searchCategoriesList,function(entry,i){dojo.connect(entry,"onclick",this,"categorySelection");dojo.connect(entry,"onclick",this,"stopEventBubble");},this);dojo.connect(window,'onresize',this,'onResize');},stopEventBubble:function(e){e.stopPropagation();},stopInputEventBubble:function(e){this.dummyCloseResult=1;},stopCategoryChooserEventBubble:function(e){this.dummyHideCategory=1;},loadResult:function(e){if(this.targetsearch==3){e.stopPropagation();}else{if(this.textBox.value.length>=this.minChars){this.searchForm.submit();}}},type:function(evt,force){if(window.event){this.keycode=window.event.keyCode;this.ktype=window.event.type;}else if(evt){this.keycode=evt.which;this.ktype=evt.type;}
if(this.t)
clearTimeout(this.t);this.t=setTimeout(dojo.hitch(this,function(){if(((this.targetsearch==3&&this.keycode==13)||(this.keycode>40||this.keycode==13)||this.keycode==32||this.keycode==8||this.keycode==0||this.ktype=="click")&&this.textBox.value.length>=this.minChars||force==1){var categories=new Array();dojo.forEach(this.searchCategoriesList,function(entry,i){if(dojo.hasClass(entry,"selected"))
categories.push(dojo.attr(entry,"id").match(/\d+/)[0]);});dojo.style(this.closeButton,"visibility","visible");dojo.style(this.textBox,"paddingRight","52px");dojo.addClass(this.closeButton,"search-area-loading");dojo.xhrGet({url:this.searchFormUrl,content:{option:"com_universal_ajax_live_search",lang:this.lang,format:"raw",module_id:this.moduleId,search_exp:this.textBox.value,'categ[]':categories,dojo_preventCache:new Date().getTime()},handleAs:"text",preventCache:false,load:dojo.hitch(this,'processResult'),error:function(e){console.log('Error: '+e);}});}}),this.keypressWait);},suggest:function(evt){if(window.event){this.keycode=window.event.keyCode;this.ktype=window.event.type;}else if(evt){this.keycode=evt.which;this.ktype=evt.type;}
if((this.keycode>40||this.keycode==32||this.keycode==8||this.keycode==0||this.ktype=="click")&&this.textBox.value.length>=2||this.keycode==46||this.keycode==8){dojo.xhrGet({url:this.searchFormUrl,content:{option:"com_universal_ajax_live_search",format:"raw",search_exp:this.textBox.value,suggest:1,dojo_preventCache:new Date().getTime()},handleAs:"text",preventCache:false,load:dojo.hitch(this,'processSuggestion'),error:function(e){console.log('Error: '+e);}});}else if(this.keycode==39&&this.getCaret(this.textBox)==this.textBox.value.length&&this.suggestBox.value!=""){this.textBox.value+=this.suggestBox.value.substr(this.textBox.value.length);this.type(evt,1);}},suggestBoxFocus:function(evt){this.textBox.focus();},getCaret:function(el){if(el.selectionStart){return el.selectionStart;}else if(document.selection){el.focus();var r=document.selection.createRange();if(r==null){return 0;}
var re=el.createTextRange(),rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint('EndToStart',re);return rc.text.length;}
return 0;},saveSuggestion:function(evt){dojo.xhrGet({url:this.searchFormUrl,content:{option:"com_universal_ajax_live_search",format:"raw",search_exp:this.textBox.value,savesuggest:1,dojo_preventCache:new Date().getTime()},handleAs:"text",preventCache:false});setTimeout(dojo.hitch(this,function(ct){if(!ct)
document.location.href=dojo.attr(this.list[this.selected-1],"href");else
document.location.href=ct.href;},evt?evt.currentTarget:null),200);},processSuggestion:function(d,xhr){try{var data=eval('('+d+')');}catch(err){alert('SuggestionError: '+d);return;}
if(data[0])
this.suggestBox.value=this.textBox.value+data[0].suggestion.toLowerCase().substr(this.textBox.value.length);else
this.suggestBox.value="";},changeText:function(e){this.textBox.value=e.currentTarget.innerHTML;},textBoxFocus:function(){if(this.catChooser)this.hideCategoryChooser();dojo.addClass(this.searchBoxContainer,"active");if(dojo.hasClass(this.textBox,"search-caption-on")){dojo.attr(this.textBox,"value","");dojo.removeClass(this.textBox,"search-caption-on");}
dojo.addClass(this.node,"active");},soundEnd:function(e){this.textBoxFocus();dojo.attr(this.textBox,"value",e.results[0].utterance);this.type(e,1);},textBoxBlur:function(){if(dojo.hasClass(this.searchBoxContainer,"active")&&!this.resultsVisible){dojo.removeClass(this.searchBoxContainer,"active");}
if(this.textBox.value.length==0){dojo.attr(this.textBox,"value",this.searchBoxCaption);dojo.addClass(this.textBox,"search-caption-on");this.suggestBox.value=""}
if(dojo.hasClass(this.node,"active"))dojo.removeClass(this.node,"active");},showCategoryChooser:function(evt){if(!this.categoryChooserVisible){this.textBox.blur();if(dojo.style(this.closeButton,"visibility")=="visible"){dojo.attr(this.textBox,"value","");this.closeResults();}
if(this.categoryFx&&this.categoryFx.status()=="playing"){this.categoryFx.stop();}
this.categoryChooserVisible=1;this.textBoxPosition=dojo.position(this.textBox,true);var left=this.getCategoryLeftPosition();dojo.style(this.searchCategories,{left:left+'px',top:(this.textBoxPosition.y+this.textBoxPosition.h-10+this.categoryChooserTopCorrection)+'px',visibility:'visible',opacity:'0'});this.categoryFx=dojo.animateProperty({node:this.searchCategories,properties:{opacity:1,top:{end:this.textBoxPosition.y+this.textBoxPosition.h+this.categoryChooserTopCorrection,units:"px"}},duration:200}).play();dojo.addClass(this.categoryChooser,"opened");this.hideCategories=dojo.connect(dojo.body(),'onclick',this,'hideCategoryChooser');}else{this.hideCategoryChooser();}},hideCategoryChooser:function(evt){if(this.dummyHideCategory==1){this.dummyHideCategory=0;return;}
dojo.disconnect(this.hideCategories);if(this.categoryFx&&this.categoryFx.status()=="playing"){this.categoryFx.stop();}
this.categoryFx=dojo.animateProperty({node:this.searchCategories,properties:{opacity:0},onEnd:function(){dojo.style(this.node,{visibility:'hidden'})},duration:200}).play();dojo.removeClass(this.categoryChooser,"opened");this.categoryChooserVisible=0;},categorySelection:function(evt){var node=evt.currentTarget;if(dojo.hasClass(node,"selected"))
dojo.removeClass(node,"selected")
else
dojo.addClass(node,"selected");}});dojo.copyTouch=function(sourceObj,targetObj){targetObj.screenX=sourceObj.screenX;targetObj.screenY=sourceObj.screenY;targetObj.identifier=sourceObj.identifier;};dojo.declare("AJAXSearchDropBase",AJAXSearchBase,{constructor:function(args){dojo.mixin(this,args);this.categoryChooserTopCorrection=0;this.searchResults=dojo.create("div",{id:"search-results"+this.id},dojo.body());this.searchResultsMoovable=dojo.create("div",{id:"search-results-moovable"+this.id},this.searchResults);this.searchResultsInner=dojo.create("div",{id:"search-results-inner"+this.id},this.searchResultsMoovable);this.touch={screenX:0,screenY:0,identifier:''};dojo.connect(this.searchResults,"onclick",this,"stopEventBubble");dojo.connect(document,"onclick",this,"closeResults");dojo.connect(this.textBox,'onkeypress',this,'arrowNavigation');},onResize:function(){this.textBoxPos=dojo.position(this.searchForm.parentNode,true);var left=this.textBoxPos.x;if(this.resultAlign==1){left+=this.textBoxPos.w-this.searchRsWidth;}
dojo.style(this.searchResults,{left:left+'px',top:this.textBoxPos.y+this.textBoxPos.h+this.resultboxTopOffset+'px'});if(this.dynamicResult=="1"){dojo.style(this.searchResults,{left:left+'px',top:this.textBoxPos.y+this.textBoxPos.h+this.resultboxTopOffset+'px',width:this.textBoxPos.w+'px'});dojo.style(this.searchResultsInner,{width:this.textBoxPos.w+'px'});if(dojo.query(".no-result",this.searchResults).length>0)
dojo.style(dojo.query(".no-result",this.searchResults)[0],{width:this.textBoxPos.w+'px'});dojo.forEach(dojo.query(".result-element",this.searchResults),function(entry,i){dojo.style(entry,{width:this.textBoxPos.w+'px'});dojo.style(dojo.query("span",entry)[0],{width:(this.textBoxPos.w-17)+'px'});if(this.showIntroText==1){dojo.style(dojo.query("span",entry)[1],{width:(this.textBoxPos.w-17)+'px'});}
if(dojo.hasClass(entry,"result-products")){dojo.style(dojo.query("span",entry)[0],{width:(this.textBoxPos.w-12-this.searchImageWidth-17)+'px'});if(this.showIntroText==1){dojo.style(dojo.query("span",entry)[1],{width:(this.textBoxPos.w-12-this.searchImageWidth-17)+'px'});}}},this);this.searchRsWidth=this.textBoxPos.w;}},processResult:function(d,xhr){d=d.match(/startofofflajnsearchresult(.+)endofofflajnsearchresult/)[1];try{var data=eval('('+d+')');}catch(err){alert('Error: '+d);return;}
var regexp=/.*&dojo_preventCache=(\d+)/i;var result=xhr.url.match(regexp);if(result[1]){if(result[1]>this.timeStamp){this.timeStamp=result[1];}else{dojo.removeClass(this.closeButton,"search-area-loading");dojo.style(this.closeButton,"visibility","visible");dojo.style(this.textBox,"paddingRight","52px");return;}}
dojo.attr(this.searchResultsInner,{innerHTML:""});this.list=[];this.pluginCounter=[];this.selected=0;this.onResize();if(data.length!=0&&!data.nores){this.paginationBand=new Array();var actualPlugin=0;for(var i in data){this.paginationBand[actualPlugin]=new Array;var pluginResults=data[i];var pluginNameDiv=dojo.create("div",{'class':"plugin-title"},this.searchResultsInner);if(actualPlugin==0){dojo.addClass(pluginNameDiv,'first');}
dojo.create("div",{'class':"plugin-title-inner",innerHTML:i+" ("+pluginResults.length+")"},pluginNameDiv);this.generatePagination(pluginNameDiv,pluginResults.length,actualPlugin);this.pluginCounter.push(pluginResults.length);this.generateResultList(pluginResults,actualPlugin);actualPlugin++;}
this.selectItem(0);}
this.tags="";if(this.searchResultsInner.childNodes.length){this.innerHeight=dojo.marginBox(this.searchResultsInner).h;}else if(data.nores&&data.nores[0]&&data.nores[0].tag&&(data.nores.length>1||this.textBox.value!=data.nores[0].tag)){var pluginNameDiv=dojo.create("div",{'class':"plugin-title first suggest"},this.searchResultsInner);dojo.create("div",{'class':"plugin-title-inner",innerHTML:this.stext},pluginNameDiv);dojo.create("div",{'class':"ajax-clear"},pluginNameDiv);for(var j=0;j<data.nores.length-1;j++){if(this.textBox.value!=data.nores[j].tag)
this.tags+="<a class='sugg-keyword'>"+data.nores[j].tag+"</a>, ";}
this.tags+="<a class='sugg-keyword'>"+data.nores[j].tag+"</a>";dojo.create("div",{'class':"no-result-suggest",innerHTML:'<span>'+this.tags+'</span>'},this.searchResultsInner);dojo.query("a[class=sugg-keyword]").connect("onclick",this,"changeText");dojo.query("a[class=sugg-keyword]").connect("onclick",this,"type");this.innerHeight=dojo.marginBox(this.searchResultsInner).h;}else{var pluginNameDiv=dojo.create("div",{'class':"plugin-title first"},this.searchResultsInner);dojo.create("div",{'class':"plugin-title-inner",innerHTML:this.noResultsTitle},pluginNameDiv);dojo.create("div",{'class':"ajax-clear"},pluginNameDiv);dojo.create("div",{'class':"no-result",innerHTML:'<span>'+this.noResults+'</span>'},this.searchResultsInner);this.innerHeight=dojo.marginBox(this.searchResultsInner).h;}
dojo.removeClass(this.closeButton,"search-area-loading");this.onResize();this.animateResult();},generatePagination:function(pluginNameDiv,dataLength,actualPlugin){this.paginationBand[actualPlugin].paginators=new Array();if(dataLength>this.productsPerPlugin){var pagination=dojo.create("div",{'class':"pagination "+"paginator-"+actualPlugin},pluginNameDiv);var pageNumber=Math.floor(dataLength/this.productsPerPlugin+0.99999);for(var num=0;num<pageNumber;num++){var paginatorElement=dojo.create("div",{'class':"pager"},pagination);paginatorElement.parentPlugin=actualPlugin;paginatorElement.page=num;dojo.connect(paginatorElement,'onclick',this,'moovePage');if(num==0){dojo.addClass(paginatorElement,'active');this.paginationBand[actualPlugin].activePaginator=paginatorElement;}
this.paginationBand[actualPlugin].paginators.push(paginatorElement);}}
dojo.create("div",{'class':"ajax-clear"},pluginNameDiv);},generateResultList:function(pluginResults,actualPlugin){var pageContainer=dojo.create("div",{'class':"page-container"},this.searchResultsInner);var pageBand=dojo.create("div",{'class':"page-band "+"page-band-"+actualPlugin},pageContainer);this.paginationBand[actualPlugin].band=pageBand;pageBand.currentPage=0;pageBand.maxPage=Math.floor(pluginResults.length/this.productsPerPlugin+0.99999);pageBand.plugin=actualPlugin;if(this.enableScroll==1){dojo.connect(pageBand,(!dojo.isMozilla?"onmousewheel":"DOMMouseScroll"),this,"scrollResultList");dojo.connect(pageBand,"ontouchstart",this,"touchStart");dojo.connect(pageBand,"ontouchend",this,"touchEnd");dojo.connect(pageBand,"ontouchmove",dojo.stopEvent);}
var page=null;for(var j=0;j<pluginResults.length;j++){if(j%this.productsPerPlugin==0){page=dojo.create("div",{'class':"page-element list"+Math.floor(j/this.productsPerPlugin)},pageBand);}
var atag=null;var introText="";if(this.showIntroText==1&&pluginResults[j].text){introText='<span class="small-desc">'+pluginResults[j].text+'</span>';}
if(pluginResults[j].product_img){atag=dojo.create("a",{'class':"result-element result-products",'onclick':"return false;",innerHTML:pluginResults[j].product_img+'<span>'+pluginResults[j].title+'</span>'+introText,href:pluginResults[j].href,target:(this.linktarget=="1"?'_blank':'')},page);}else{atag=dojo.create("a",{'class':"result-element",'onclick':"return false;",innerHTML:'<span>'+pluginResults[j].title+'</span>'+introText,href:pluginResults[j].href},page);}
dojo.connect(atag,'onclick',this,'saveSuggestion');atag.plugin=actualPlugin;atag.item=j;this.list.push(atag);dojo.create("div",{'class':"ajax-clear"},atag);}
if(pluginResults.length<this.productsPerPlugin){dojo.style(pageContainer,"height",dojo.marginBox(pageBand).h+"px");}
if(pluginResults.length>=this.seemoreAfter){dojo.create("div",{'id':"seemore",'class':"seemore",innerHTML:'<span>'+this.seeMoreResults+'</span>'},this.searchResultsInner);dojo.connect(dojo.byId("seemore"),'onclick',this,'loadResult');dojo.removeClass(this.searchResultsInner,"withoutseemore");}else{dojo.addClass(this.searchResultsInner,"withoutseemore");}},moovePage:function(event){var pager=event.target;var band=this.paginationBand[pager.parentPlugin].band;dojo.removeClass(this.paginationBand[pager.parentPlugin].activePaginator,"active");dojo.addClass(pager,"active");this.paginationBand[pager.parentPlugin].activePaginator=pager;if(band.actFx&&band.actFx.status()=="playing"){band.actFx.stop();}
band.actFx=dojo.animateProperty({node:band,properties:{left:-pager.page*this.searchRsWidth},duration:500}).play();this.textBox.focus();},scrollPluginResults:function(band,page){if(band.actFx&&band.actFx.status()=="playing"){band.actFx.stop();}
band.actFx=dojo.animateProperty({node:band,properties:{left:-page*this.searchRsWidth},duration:250}).play();band.currentPage=page;},animateResult:function(){if(this.actFx&&this.actFx.status()=="playing"){this.actFx.stop();}
this.resultsVisible=1;dojo.style(this.searchResults,"visibility","visible");if(this.innerHeight){this.actFx=this.getResultBoxAnimation();}else{this.actFx=dojo.animateProperty({node:this.searchResultsMoovable,properties:{height:0},duration:500,onEnd:dojo.hitch(this,'removeResults')}).play();}
dojo.style(this.closeButton,"visibility","visible");dojo.style(this.textBox,"paddingRight","52px");},closeResults:function(e){dojo.style(this.textBox,"paddingRight","30px");if(e&&e.button&&e.button>0)return;if(this.dummyCloseResult==1){this.dummyCloseResult=0;return;}
if(this.actFx&&this.actFx.status()=="playing"){if(dojo.hasClass(this.textBox,"search-caption-on"))
return;this.actFx.stop();}
this.actFx=this.getCloseResultBoxAnimation();dojo.style(this.closeButton,"visibility","hidden");dojo.style(this.textBox,"paddingRight","30px");dojo.attr(this.textBox,"value",this.searchBoxCaption);dojo.addClass(this.textBox,"search-caption-on");this.suggestBox.value=""},removeResults:function(){this.fadeInResult=1;dojo.attr(this.searchResultsInner,{innerHTML:""});if(this.searchResultsInner.childNodes.length){this.innerHeight=dojo.marginBox(this.searchResultsInner).h;}else{this.innerHeight=0;}
dojo.style(this.searchResults,"visibility","hidden");this.resultsVisible=0;if(dojo.hasClass(this.searchBoxContainer,"active")&&!this.resultsVisible){dojo.removeClass(this.searchBoxContainer,"active");}},arrowNavigation:function(evt){if(evt.keyCode==27){this.textBox.blur();if(dojo.style(this.closeButton,"visibility")=="visible"){dojo.attr(this.textBox,"value","");this.closeResults();}}
if(this.list.length){if(evt.keyCode==38){this.selectItem(this.selected-1);}else if(evt.keyCode==40){this.selectItem(this.selected+1);}else if(evt.keyCode==13){if(this.selected==0){this.loadResult();}else{this.saveSuggestion();}}
if(this.selected>0){var actPlugin=this.list[this.selected-1].plugin;var actPluginItem=this.list[this.selected-1].item;var band=this.paginationBand[actPlugin].band;var pgNumber=Math.floor(actPluginItem/this.productsPerPlugin);if(this.paginationBand[actPlugin].activePaginator){dojo.removeClass(this.paginationBand[actPlugin].activePaginator,"active");this.scrollPluginResults(band,pgNumber);var pager=this.paginationBand[actPlugin].paginators[pgNumber];dojo.addClass(pager,"active");this.paginationBand[actPlugin].activePaginator=pager;}}}else if(evt.keyCode==13){this.loadResult();}},scrollResultList:function(evt){var scroll=evt[(!dojo.isMozilla?"wheelDelta":"detail")]*(!dojo.isMozilla?1:-1);var band=evt.currentTarget;if(band.maxPage>1){var actPlugin=band.plugin;dojo.removeClass(this.paginationBand[actPlugin].activePaginator,"active");var pgNumber=band.currentPage;if(scroll<0&&pgNumber<band.maxPage-1){pgNumber++;}else if(scroll<0&&pgNumber>=band.maxPage-1){pgNumber=0;}else if(scroll>0&&pgNumber>0){pgNumber--;}else if(scroll>0&&pgNumber<=0){pgNumber=band.maxPage-1;}
this.scrollPluginResults(band,pgNumber);var pager=this.paginationBand[actPlugin].paginators[pgNumber];dojo.addClass(pager,"active");this.paginationBand[actPlugin].activePaginator=pager;dojo.stopEvent(evt);}},selectItem:function(num){if(num>=this.list.length+1){num-=this.list.length+1;}
if(num<0){num+=this.list.length+1;}
if(this.list[this.selected-1]){dojo.removeClass(this.list[this.selected-1],"selected-element");}
if(this.list[num-1]){dojo.addClass(this.list[num-1],"selected-element");}
this.selected=num;},post_to_url:function(path,params,method){method=method||"post";var form=document.createElement("form");form.setAttribute("method",method);form.setAttribute("action",path);for(var key in params){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",params[key]);form.appendChild(hiddenField);}
document.body.appendChild(form);form.submit();},touchStart:function(e){dojo.copyTouch(e.changedTouches[0],this.touch);},touchEnd:function(e){if(this.touch.identifier==e.changedTouches[0].identifier){var dist=Math.sqrt(Math.pow(e.changedTouches[0].screenX-this.touch.screenX,2)+Math.pow(e.changedTouches[0].screenY-this.touch.screenY,2));if(dist>80){var deg=Math.asin((e.changedTouches[0].screenY-this.touch.screenY)/dist)*180/Math.PI;if(deg<45&&deg>-45){var scroll=e.changedTouches[0].screenX-this.touch.screenX;this.paginateTouch(e,scroll);}}}},paginateTouch:function(evt,direction){var band=evt.currentTarget;if(band.maxPage>1){var actPlugin=band.plugin;dojo.removeClass(this.paginationBand[actPlugin].activePaginator,"active");var pgNumber=band.currentPage;if(direction<0&&pgNumber<band.maxPage-1){pgNumber++;}else if(direction<0&&pgNumber>=band.maxPage-1){pgNumber=0;}else if(direction>0&&pgNumber>0){pgNumber--;}else if(direction>0&&pgNumber<=0){pgNumber=band.maxPage-1;}
this.scrollPluginResults(band,pgNumber);var pager=this.paginationBand[actPlugin].paginators[pgNumber];dojo.addClass(pager,"active");this.paginationBand[actPlugin].activePaginator=pager;dojo.stopEvent(evt);}}});var AJAXSearch={};dojo.copyTouch=function(sourceObj,targetObj){targetObj.screenX=sourceObj.screenX;targetObj.screenY=sourceObj.screenY;targetObj.identifier=sourceObj.identifier;};dojo.declare("AJAXSearchflat",AJAXSearchBase,{constructor:function(args){this.controlPanelShoved=0;this.noResultMessageDivShoved=0;this.searchResults=dojo.byId("offlajn-ajax-tile-results");if(!this.searchResults){alert('For using the Flat theme you should enable the "AJAX Live Search results" module or insert this code into your template:\n <div id="offlajn-ajax-tile-results"></div>');}
dojo.style(this.searchResults,"height","0px");this.resultWidthStyle=dojo.create("style",{},document.head);this.actualPage=1;this.searchPageOut=dojo.create("div",{id:"offlajn-ajax-search-page-out"},this.searchResults);this.searchResultsInner=dojo.create("div",{id:"offlajn-ajax-search-results-inner"},this.searchResults);this.shovedResultIds=[];this.touch={screenX:0,screenY:0,identifier:''};dojo.connect(this.searchResultsInner,"ontouchstart",this,"touchStart");dojo.connect(this.searchResultsInner,"ontouchend",this,"touchEnd");dojo.connect(this.textBox,"onclick",this,"stopEventBubble");this.resultHeightFx=dojo.animateProperty({node:this.searchResults,properties:{height:{end:dojo.position(this.searchResultsInner).h,units:"px"}},duration:300});this.categoryChooserTopCorrection=5;this.searchImageWidth=parseInt(this.searchImageWidth);this.resultsPadding=parseInt(this.resultsPadding);},createControlPanel:function(){if(!this.controlPanelShoved){this.controlPanel=dojo.create("div",{"class":"offlajn-ajax-search-control-panel"},this.searchResults,"first");this.innerControlPanel=dojo.create("div",{"class":"inner-control-panel"},this.controlPanel);this.previousButton=dojo.create("div",{"class":"offlajn-prev offlajn-button",innerHTML:this.controllerPrev},this.innerControlPanel);this.nextButton=dojo.create("div",{"class":"offlajn-next offlajn-button",innerHTML:this.controllerNext},this.innerControlPanel);this.paginators=dojo.create("div",{"class":"offlajn-paginators"},this.innerControlPanel);if(!('ontouchstart'in window))dojo.connect(this.previousButton,"onclick",dojo.hitch(this,'refreshPage',-1,"flipright"));dojo.connect(this.previousButton,"ontouchend",dojo.hitch(this,'refreshPage',-1,"flipright"));if(!('ontouchstart'in window))dojo.connect(this.nextButton,"onclick",dojo.hitch(this,'refreshPage',1,"flipleft"));dojo.connect(this.nextButton,"ontouchend",dojo.hitch(this,'refreshPage',1,"flipleft"));this.controlPanelShoved=1;}},closeControlPanel:function(){dojo.query(".offlajn-ajax-search-control-panel").forEach(dojo.destroy);this.controlPanelShoved=0;},type:function(evt,force){if(window.event){this.keycode=window.event.keyCode;this.ktype=window.event.type;}else if(evt){this.keycode=evt.which;this.ktype=evt.type;}
if(this.t)
clearTimeout(this.t);this.t=setTimeout(dojo.hitch(this,function(){if(((this.targetsearch==3&&this.keycode==13)||(this.keycode>40||this.keycode==13)||this.keycode==32||this.keycode==8||this.keycode==0||this.ktype=="click")&&this.textBox.value.length>=this.minChars||force==1){var categories=new Array();dojo.forEach(this.searchCategoriesList,function(entry,i){if(dojo.hasClass(entry,"selected"))
categories.push(dojo.attr(entry,"id").match(/\d+/)[0]);});dojo.style(this.closeButton,"visibility","visible");dojo.style(this.textBox,"paddingRight","70px");dojo.addClass(this.closeButton,"search-area-loading");dojo.xhrGet({url:this.searchFormUrl,content:{option:"com_universal_ajax_live_search",lang:this.lang,format:"raw",module_id:this.moduleId,search_exp:this.textBox.value,'categ[]':categories,dojo_preventCache:new Date().getTime()},handleAs:"text",preventCache:false,load:dojo.hitch(this,'processResult'),error:function(e){console.log('Error: '+e);}});}}),this.keypressWait);},processResult:function(d,xhr){d=d.match(/startofofflajnsearchresult(.+)endofofflajnsearchresult/)[1];try{var data=eval('('+d+')');}catch(err){alert('Error: '+d);return;}
var regexp=/.*&dojo_preventCache=(\d+)/i;var result=xhr.url.match(regexp);if(result[1]){if(result[1]>this.timeStamp){this.timeStamp=result[1];}else{dojo.removeClass(this.closeButton,"search-area-loading");dojo.style(this.closeButton,"visibility","visible");return;}}
this.list=[];this.pluginCounter=[];this.selected=0;this.onResize();this.newResultIds=[];this.newResults={};if(data.length!=0&&!data.nores){for(var i in data){var pluginResults=data[i];for(var j=0;j<pluginResults.length;j++){pluginResults[j].pluginName=i;this.newResultIds.push(pluginResults[j].id);this.newResults[pluginResults[j].id]=pluginResults[j];}}
this.createControlPanel();if(this.noResultMessageDivShoved){dojo.destroy(this.noResultMessageDiv);this.noResultMessageDivShoved=0;dojo.query("div[class=no-result-suggest]").forEach(dojo.destroy);}
if(this.actualPage==1){var correction=0;var length=this.shovedResultIds.length;for(var i=0;i<length&&i<this.resultsPerPage;i++){if(dojo.indexOf(this.newResultIds.slice(0,this.resultsPerPage),this.shovedResultIds[i-correction])==-1){this.removeCard(this.shovedResultIds[i-correction]);correction++;}}
for(var i=0;i<this.newResultIds.length&&i<this.resultsPerPage;i++){if(dojo.indexOf(this.shovedResultIds,this.newResultIds[i])==-1){this.addCard(this.newResults[this.newResultIds[i]]);this.shovedResultIds.push(this.newResultIds[i]);}}}else{var length=this.shovedResultIds.length;for(var i=0;i<length;i++){this.removeCard(this.shovedResultIds[0]);}
for(var i=0;i<this.newResultIds.length&&i<this.resultsPerPage;i++){if(dojo.indexOf(this.shovedResultIds,this.newResultIds[i])==-1){this.addCard(this.newResults[this.newResultIds[i]]);this.shovedResultIds.push(this.newResultIds[i]);}}
this.actualPage=1;}
this.pageNumber=Math.floor(this.newResultIds.length/this.resultsPerPage+0.99999);this.paginators.innerHTML="";for(var i=1;i<=this.pageNumber;i++){var el=dojo.create("div",{"class":"offlajn-button",innerHTML:i},this.paginators);if(i==1)dojo.addClass(el,"pushed");el.pageID=i;if(!('ontouchstart'in window))dojo.connect(el,"onclick",this,"jumptoPage");dojo.connect(el,"ontouchend",this,"jumptoPage");}
this.cardHeight=dojo.position(dojo.byId(this.shovedResultIds[0])).h;}else if(data.nores&&data.nores[0]&&data.nores[0].tag&&(data.nores.length>1||this.textBox.value!=data.nores[0].tag)){this.createControlPanel();this.paginators.innerHTML="";var length=this.shovedResultIds.length;for(var i=0;i<length;i++){this.removeCard(this.shovedResultIds[0]);}
this.shovedResultIds=[];dojo.query("div[class=no-result-suggest]").forEach(dojo.destroy);if(!this.noResultMessageDivShoved){this.noResultMessageDiv=dojo.create("div",{'id':"no-result-message",innerHTML:'<span>'+this.stext+'</span>'},this.searchResultsInner);this.noResultMessageDivShoved=1;}
for(var j=0;j<data.nores.length-1;j++){if(this.textBox.value!=data.nores[j].tag)
dojo.create("div",{'class':"no-result-suggest",innerHTML:data.nores[j].tag},this.searchResultsInner);}
dojo.query("div[class=no-result-suggest]").connect("onclick",this,"changeText");dojo.query("div[class=no-result-suggest]").connect("onclick",this,"type");}else{this.createControlPanel();this.paginators.innerHTML="";var length=this.shovedResultIds.length;for(var i=0;i<length;i++){this.removeCard(this.shovedResultIds[0]);}
this.shovedResultIds=[];if(!this.noResultMessageDivShoved){this.noResultMessageDiv=dojo.create("div",{'id':"no-result-message",innerHTML:'<span>'+this.noResults+'</span>'},this.searchResultsInner);this.noResultMessageDivShoved=1;}}
dojo.removeClass(this.closeButton,"search-area-loading");this.actualiseResultHeight();this.actualiseResultWidth();if(window.Shadowbox){Shadowbox.clearCache();Shadowbox.setup();}},addCard:function(element){var tmpl=((this.showCat==1)?'<div class="search-result-card-category">'+element.pluginName+'</div>':'')+'<div class="search-result-card minimized front">'+'<div class="search-result-overlay">'+'<div class="search-result-beacon">'+'<div class="beaconCircle1"></div>'+'<div class="beaconCircle2"></div>'+'<div class="imgbeacon"></div>'+'</div>'+'</div>'+
((element.price)?'<div class="search-result-price">'+element.price+'</div>':'')+
((typeof element.product_img!="undefined")?element.product_img:'<img src=""/>')+
((!('ontouchstart'in window))?'<div class="search-result-content">'+'<div class="search-result-title">'+'<span title="'+element.title+'">'+element.title+'</span>'+'</div>'+
((this.showIntroText=="1")?'<div class="search-result-inner">'+element.text+'</div>':'')+
((typeof element.product_img!="undefined")?element.product_img:'<img src=""/>')+'</div>':'')+'<div class="search-result-content">'+'<div class="search-result-title">'+'<span title="'+element.title+'">'+element.title+'</span>'+'</div>'+
((this.showIntroText=="1")?'<div class="search-result-inner">'+element.text+'</div>':'')+'</div>'+'</div>';var srLink=dojo.create("a",{id:element.id,'class':"search-result-link",'onclick':"return false;",'href':element.href,innerHTML:tmpl},this.searchResultsInner);var marginSeparator=dojo.create("div",{'class':"search-result-link search-result-sep",'onclick':"return false;"},this.searchResultsInner);var img=dojo.query("img",srLink)[1];if(!('ontouchstart'in window)){dojo.addClass(img,"blurred");dojo.style(img,{"-webkit-filter":"url('#searchblur')","-moz-filter":"url('#searchblur')","-o-filter":"url('#searchblur')","filter":"url('#searchblur')"});}
if(element.href.match(/\.jpg$|\.png$/i)){dojo.attr(srLink,"rel","shadowbox[UniversalAJAXLiveSearch];");dojo.attr(srLink,"title",element.title);}else{dojo.connect(srLink,'onclick',this,'stopEventBubble');dojo.connect(srLink,'onclick',this,'saveSuggestion');}
dojo.connect(dojo.query("img",srLink)[0],'onload',this,'showCard');},removeCard:function(id){if(dojo.byId(id)&&dojo.byId(id).children[0]){try{dojo.byId(id).children[0].addClass("minimized");}catch(err){}
dojo.addClass(dojo.byId(id),"minimized");setTimeout(dojo.hitch(this,function(id){dojo.destroy(dojo.byId(id).nextSibling);dojo.destroy(id);this.actualiseResultHeight();},id),400);dojo.animateProperty({node:dojo.byId(id),properties:{height:{end:0,units:"px"}},duration:400,}).play();}
this.shovedResultIds.splice(this.shovedResultIds.indexOf(id),1);},showCard:function(evt){setTimeout(dojo.hitch(this,function(card){if(dojo.hasClass(card,"minimized"))
dojo.removeClass(card,"minimized");if(card.previousSibling)
dojo.addClass(card.previousSibling,"show")
this.actualiseResultHeight();},evt?evt.currentTarget.parentNode:null),Math.floor((Math.random()*400)+1));},addClickedCard:function(event){var card=event.currentTarget;dojo.addClass(card,"clicked");},getResultBoxAnimation:function(){if(this.fadeInResult){dojo.style(this.searchResultsMoovable,"height",this.innerHeight+"px");this.textBoxPos=dojo.position(this.searchForm,true);dojo.style(this.searchResultsMoovable,"opacity",0);dojo.style(this.searchResultsMoovable,"top",'-10px');this.fadeInResult=0;return dojo.animateProperty({node:this.searchResultsMoovable,properties:{opacity:1,top:{end:0,units:"px"}},duration:300}).play();}else{return dojo.animateProperty({node:this.searchResultsMoovable,properties:{height:{start:dojo.style(this.searchResultsMoovable,'height'),end:this.innerHeight}},duration:500}).play();}},getCloseResultBoxAnimation:function(){return dojo.animateProperty({node:this.searchResultsMoovable,properties:{opacity:0,top:{end:10,units:"px"}},duration:300,onEnd:dojo.hitch(this,'removeResults')}).play();},getCategoryLeftPosition:function(){var categorySize=dojo.marginBox(this.searchCategories);return this.textBoxPosition.x;},closeResults:function(e){if(e&&e.button&&e.button>0)return;dojo.addClass(this.searchResults,"hidde");dojo.style(this.textBox,"paddingRight","40px");this.actualiseResultHeight(1);dojo.style(this.closeButton,"visibility","hidden");setTimeout(dojo.hitch(this,function(){var length=this.shovedResultIds.length;for(var i=0;i<length;i++){dojo.destroy(this.shovedResultIds[0]);this.shovedResultIds.splice(this.shovedResultIds.indexOf(this.shovedResultIds[0]),1);}
this.shovedResultIds=[];this.closeControlPanel();dojo.removeClass(this.closeButton,"search-area-loading");dojo.attr(this.textBox,"value",this.searchBoxCaption);dojo.addClass(this.textBox,"search-caption-on");this.suggestBox.value="";if(this.noResultMessageDivShoved){dojo.destroy(this.noResultMessageDiv);this.noResultMessageDivShoved=0;dojo.query("div[class=no-result-suggest]").forEach(dojo.destroy);}
this.searchResultsInner.innerHTML="";dojo.removeClass(this.searchResults,"hidde");dojo.style(this.searchResults,"display","none");}),250);},actualiseResultHeight:function(fix){if(this.shovedResultIds[0]){this.cardHeight=dojo.position(dojo.byId(this.shovedResultIds[0])).h;}
var size=dojo.position(this.searchResultsInner).h+(38)*this.controlPanelShoved;var maxsize=this.lineNumber*this.cardHeight+(38)*this.controlPanelShoved;if(maxsize>0&&size>maxsize)
size=maxsize;if(fix)
{dojo.style(this.searchResults,"height","0px");}
else
{dojo.style(this.searchResults,"height",size+"px");dojo.style(this.searchResults,"display",size>0?"block":"none");}},actualiseResultWidth:function(){if(this.fullWidth=="0"){var count=Math.floor(dojo.position(this.searchResults).w/(this.searchImageWidth+10));this.lineNumber=Math.floor(this.resultsPerPage/count+0.99999);var margin=((dojo.position(this.searchResults).w%(this.searchImageWidth+10))/count/2-1)+5;if(dojo.isIE!=8)
this.resultWidthStyle.innerHTML="#offlajn-ajax-tile-results .search-result-card{margin: 0px "+Math.floor(margin)+"px "+Math.floor(margin)+"px; }";}else{this.lineNumber=this.resultsPerPage;}},showPageByID:function(pagenumber,directionClass){if(pagenumber!=this.actualPage){var paginators=dojo.query(".offlajn-button",this.paginators);var oldButton=paginators[this.actualPage-1];var newButton=paginators[pagenumber-1];if(!oldButton)return;if(dojo.hasClass(oldButton,"pushed"))
dojo.removeClass(oldButton,"pushed");if(!dojo.hasClass(newButton,"pushed"))
dojo.addClass(newButton,"pushed");this.searchResultsInner.innerHTML="";this.shovedResultIds=[];for(var i=(pagenumber-1)*this.resultsPerPage;i<this.newResultIds.length&&i<pagenumber*this.resultsPerPage;i++){if(dojo.indexOf(this.shovedResultIds,this.newResultIds[i])==-1){this.addCard(this.newResults[this.newResultIds[i]]);this.shovedResultIds.push(this.newResultIds[i]);}}
if(window.Shadowbox){var i,max=this.searchPageOut.children.length;for(i=0;i<max;++i)dojo.attr(this.searchPageOut.children[i],"rel","");Shadowbox.clearCache();Shadowbox.setup();}
this.actualPage=pagenumber;}},refreshPage:function(direction,directionClass){var gotoPage=this.actualPage+direction;if(gotoPage>this.pageNumber)
gotoPage-=this.pageNumber;else if(gotoPage<=0){gotoPage+=this.pageNumber;}
this.showPageByID(gotoPage,directionClass);},jumptoPage:function(event){this.showPageByID(event.currentTarget.pageID);},onResize:function(){if(this.fullWidth=="1"){this.cardHeight=dojo.position(this.searchResults).w*this.resultImageHeight/this.resultImageWidth+10;this.lineNumber=this.resultsPerPage;}
this.actualiseResultWidth();this.actualiseResultHeight();},touchStart:function(e){dojo.copyTouch(e.changedTouches[0],this.touch);this.touch.scrollY=window.scrollY;},touchEnd:function(e){if(this.touch.identifier==e.changedTouches[0].identifier){var dist=Math.sqrt(Math.pow(e.changedTouches[0].screenX-this.touch.screenX,2)+Math.pow(e.changedTouches[0].screenY-this.touch.screenY,2));if(dist>100){if(Math.abs(this.touch.scrollY-window.scrollY)<125){var scroll=e.changedTouches[0].screenX-this.touch.screenX;if(scroll>0){setTimeout(dojo.hitch(this,"refreshPage",-1,"flipright"),1);}else{setTimeout(dojo.hitch(this,"refreshPage",1,"flipleft"),1);}}}}},showCategoryChooser:function(evt){if(!this.categoryChooserVisible){if(this.categoryFx&&this.categoryFx.status()=="playing"){this.categoryFx.stop();}
this.categoryChooserVisible=1;this.textBoxPosition=dojo.position(this.textBox,true);var left=this.getCategoryLeftPosition();dojo.style(this.searchCategories,{left:left+'px',top:(this.textBoxPosition.y+this.textBoxPosition.h-10+this.categoryChooserTopCorrection)+'px',visibility:'visible',opacity:'0'});this.categoryFx=dojo.animateProperty({node:this.searchCategories,properties:{opacity:1,top:{end:this.textBoxPosition.y+this.textBoxPosition.h+this.categoryChooserTopCorrection,units:"px"}},duration:200}).play();dojo.addClass(this.categoryChooser,"opened");this.hideCategories=dojo.connect(dojo.body(),'onclick',this,'hideCategoryChooser');}else{this.hideCategoryChooser();}},hideCategoryChooser:function(evt){if(this.dummyHideCategory==1){this.dummyHideCategory=0;return;}
dojo.disconnect(this.hideCategories);if(this.categoryFx&&this.categoryFx.status()=="playing"){this.categoryFx.stop();}
this.categoryFx=dojo.animateProperty({node:this.searchCategories,properties:{opacity:0},onEnd:function(){dojo.style(this.node,{visibility:'hidden'})},duration:200}).play();dojo.removeClass(this.categoryChooser,"opened");this.categoryChooserVisible=0;},categorySelection:function(evt){var node=evt.currentTarget;if(dojo.hasClass(node,"selected"))
dojo.removeClass(node,"selected")
else
dojo.addClass(node,"selected");var textBoxVal=dojo.attr(this.textBox,"value");if(textBoxVal.length>=this.minChars&&textBoxVal!=this.searchBoxCaption){this.type(null,1);}}});})();";}